<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="../recursos/audio/favicon.ico"
      type="image/x-icon"
    />
    <title>Super Netos - Minhas Figurinhas</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Italiana&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap");
      * {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      @font-face {
        font-family: "Material Symbols Rounded";
        font-style: normal;
        font-weight: 400;
        src: url(https://fonts.gstatic.com/s/materialsymbolsrounded/v226/syl0-zNym6YjUruM-QrEh7-nyTnjDwKNJ_190FjpZIvDmUSVOK7BDB_Qb9vUSzq3wzLK-P0J-V_Zs-QtQth3-jOcbTCVpeRL2w5rwZu2rIelXxc.woff2)
          format("woff2");
      }
      .material-symbols-rounded {
        font-family: "Material Symbols Rounded";
        font-weight: normal;
        font-style: normal;
        font-size: 24px;
        line-height: 1;
        letter-spacing: normal;
        text-transform: none;
        display: inline-block;
        white-space: nowrap;
        word-wrap: normal;
        direction: ltr;
        font-feature-settings: "liga";
        -moz-font-feature-settings: "liga";
        -moz-osx-font-smoothing: grayscale;
      }
      html,
      body {
        height: 100%;
        font-family: "Roboto", serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        overflow-x: hidden;
      }
      .container {
        min-height: 100vh;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .header {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 3rem;
      }
      .header-top {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1.5rem;
        flex-wrap: wrap;
      }
      .header-image {
        width: 160px;
        max-width: 35vw;
        height: auto;
      }
      .header-title {
        font-size: 3rem;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        color: #fff;
      }
      .header-description {
        font-size: 1.2rem;
        opacity: 0.9;
        max-width: 600px;
        text-align: center;
        margin: 0;
      }

      /* Álbum e Figurinhas Disponíveis */
      .album-container {
        width: 100%;
        max-width: 1200px;
        display: flex;
        gap: 2rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      .album-section {
        flex: 1;
        min-width: 300px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        text-align: center;
        color: #fff;
      }

      .album-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }

      .album-slot {
        aspect-ratio: 3 / 4;
        background: rgba(255, 255, 255, 0.9);
        border: 3px dashed #ccc;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .album-slot.drag-over {
        border-color: #4caf50;
        background: rgba(76, 175, 80, 0.2);
        transform: scale(1.05);
      }

      .album-slot.filled {
        border-style: solid;
        background: white;
      }

      .album-slot .slot-number {
        font-size: 2rem;
        color: #ccc;
        font-weight: bold;
      }

      .album-slot .slot-label {
        font-size: 0.9rem;
        color: #999;
        margin-top: 0.5rem;
      }

      .album-slot.filled .slot-number,
      .album-slot.filled .slot-label {
        display: none;
      }

      .sticker-in-album {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 0.5rem;
      }

      .sticker-in-album img {
        width: 100%;
        height: 60%;
        object-fit: contain;
        border-radius: 8px;
      }

      .sticker-in-album .sticker-name {
        font-size: 0.9rem;
        font-weight: bold;
        color: #2a2353;
        text-align: center;
      }

      /* Figurinhas Disponíveis */
      .available-stickers {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-height: 600px;
        overflow-y: auto;
      }

      .sticker-item {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: grab;
        transition: all 0.3s ease;
        border: 3px solid transparent;
      }

      .sticker-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .sticker-item.dragging {
        opacity: 0.5;
        cursor: grabbing;
      }

      .sticker-item.locked {
        opacity: 0.5;
        cursor: not-allowed;
        filter: grayscale(100%);
      }

      .sticker-item img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border-radius: 8px;
      }

      .sticker-info {
        flex: 1;
      }

      .sticker-info .name {
        font-weight: bold;
        color: #2a2353;
        font-size: 1.1rem;
      }

      .sticker-info .cost {
        color: #667eea;
        font-size: 0.9rem;
        margin-top: 0.3rem;
      }

      .sticker-info .status {
        color: #666;
        font-size: 0.85rem;
        margin-top: 0.2rem;
      }

      /* Scrollbar personalizada */
      .available-stickers::-webkit-scrollbar {
        width: 8px;
      }

      .available-stickers::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      .available-stickers::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
      }

      .available-stickers::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      /* Cores das bordas por figurinha */
      .sticker-item[data-id="1"],
      .album-slot[data-id="1"].filled {
        border-color: #ffd700;
      }
      .sticker-item[data-id="2"],
      .album-slot[data-id="2"].filled {
        border-color: #ff8c00;
      }
      .sticker-item[data-id="3"],
      .album-slot[data-id="3"].filled {
        border-color: #32cd32;
      }
      .sticker-item[data-id="4"],
      .album-slot[data-id="4"].filled {
        border-color: #ff1493;
      }
      .sticker-item[data-id="5"],
      .album-slot[data-id="5"].filled {
        border-color: #1e90ff;
      }

      .figurinhas-grid {
        width: 100%;
        max-width: 1200px;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        align-items: center;
        margin-bottom: 3rem;
      }
      .figurinhas-row {
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        flex-wrap: wrap;
      }
      .selo-card {
        background: #ffffff;
        border: 6px solid
          var(--figurinha-border-color, rgba(118, 75, 162, 0.35));
        border-radius: 24px;
        color: #2a2353;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        text-align: center;
        gap: 0.75rem;
        box-shadow: 0 12px 24px rgba(10, 10, 30, 0.12);
        position: relative;
        overflow-y: auto;
        overflow-x: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .selo-card.horizontal {
        width: clamp(280px, 35vw, 450px);
        min-height: 320px;
        height: auto;
      }
      .selo-card.vertical {
        aspect-ratio: 9 / 16;
        width: clamp(160px, 22vw, 260px);
      }
      .selo-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 16px 36px rgba(10, 10, 30, 0.2);
      }
      .selo-card.locked {
        opacity: 0.6;
        box-shadow: none;
        filter: grayscale(0.15);
      }
      .selo-card.locked .selo-icon {
        filter: grayscale(100%);
      }
      .selo-card.locked .selo-image {
        filter: grayscale(100%) blur(3px);
        opacity: 0.4;
      }
      /* Cores das bordas por figurinha */
      .selo-card[data-id="1"] {
        border-color: #ffd700;
        box-shadow: 0 12px 24px rgba(255, 215, 0, 0.3);
      }
      .selo-card[data-id="1"]:hover {
        box-shadow: 0 16px 36px rgba(255, 215, 0, 0.4);
      }
      .selo-card[data-id="2"] {
        border-color: #ff8c00;
        box-shadow: 0 12px 24px rgba(255, 140, 0, 0.3);
      }
      .selo-card[data-id="2"]:hover {
        box-shadow: 0 16px 36px rgba(255, 140, 0, 0.4);
      }
      .selo-card[data-id="3"] {
        border-color: #32cd32;
        box-shadow: 0 12px 24px rgba(50, 205, 50, 0.3);
      }
      .selo-card[data-id="3"]:hover {
        box-shadow: 0 16px 36px rgba(50, 205, 50, 0.4);
      }
      .selo-card[data-id="4"] {
        border-color: #ff1493;
        box-shadow: 0 12px 24px rgba(255, 20, 147, 0.3);
      }
      .selo-card[data-id="4"]:hover {
        box-shadow: 0 16px 36px rgba(255, 20, 147, 0.4);
      }
      .selo-card[data-id="5"] {
        border-color: #1e90ff;
        box-shadow: 0 12px 24px rgba(30, 144, 255, 0.3);
      }
      .selo-card[data-id="5"]:hover {
        box-shadow: 0 16px 36px rgba(30, 144, 255, 0.4);
      }
      .selo-icon {
        font-size: clamp(2.5rem, 4vw, 4rem);
        display: block;
      }
      .selo-image {
        width: 100%;
        height: auto;
        max-height: 200px;
        object-fit: contain;
        border-radius: 12px;
        margin-bottom: 0.5rem;
        flex-shrink: 0;
      }
      .selo-card.horizontal .selo-image {
        max-height: 150px;
        max-width: 90%;
      }
      .selo-card.vertical .selo-image {
        max-height: 250px;
      }
      .selo-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2a2353;
        flex-shrink: 0;
      }
      .selo-description {
        font-size: 1rem;
        color: #4a4466;
        line-height: 1.5;
        flex-shrink: 0;
      }
      .selo-date {
        font-size: 0.9rem;
        color: #6a6585;
        font-style: italic;
        flex-shrink: 0;
      }
      .selo-card.locked .selo-date {
        display: none;
      }
      .selo-card.locked .selo-description::after {
        content: " - Bloqueado";
        color: #ff6b6b;
        font-weight: bold;
      }
      @media (max-width: 768px) {
        .header-title {
          font-size: 2.2rem;
        }
        .figurinhas-row {
          flex-direction: column;
          align-items: center;
        }
        .selo-card.horizontal {
          width: min(100%, 360px);
          min-height: 300px;
        }
        .selo-card.vertical {
          width: min(100%, 260px);
        }
      }
      .stats-container {
        display: flex;
        gap: 2rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        min-width: 200px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        display: block;
        margin-bottom: 0.5rem;
      }
      .stat-label {
        font-size: 1rem;
        opacity: 0.8;
      }
      .back-button {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 1rem 2rem;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }
      .back-button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .reset-button {
        background: rgba(255, 107, 107, 0.2);
        border: 2px solid rgba(255, 107, 107, 0.5);
        color: #ff6b6b;
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-left: 1rem;
      }
      .reset-button:hover {
        background: rgba(255, 107, 107, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2);
      }
      .buttons-container {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
        .header h1 {
          font-size: 2rem;
        }
        .album-container {
          flex-direction: column;
        }
        .album-section {
          min-width: 100%;
        }
        .album-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .available-stickers {
          max-height: 400px;
        }
        .sticker-item {
          padding: 0.8rem;
        }
        .sticker-item img {
          width: 50px;
          height: 50px;
        }
        .selos-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
        .stats-container {
          gap: 1rem;
        }
        .stat-card {
          min-width: 150px;
          padding: 1rem;
        }
        .stat-number {
          font-size: 2rem;
        }
        .buttons-container {
          flex-direction: column;
          gap: 1rem;
        }
        .reset-button {
          margin-left: 0;
        }
      }
      /* Animações */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes stickerPaste {
        0% {
          transform: scale(0) rotate(-10deg);
          opacity: 0;
        }
        50% {
          transform: scale(1.2) rotate(5deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      @keyframes celebrate {
        0%,
        100% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.1) rotate(-5deg);
        }
        75% {
          transform: scale(1.1) rotate(5deg);
        }
      }

      .sticker-in-album {
        animation: stickerPaste 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .album-slot.celebrate {
        animation: celebrate 0.5s ease;
      }

      .selo-card {
        animation: slideInUp 0.6s ease forwards;
      }
      .selo-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .selo-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .selo-card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .selo-card:nth-child(4) {
        animation-delay: 0.4s;
      }
      .selo-card:nth-child(5) {
        animation-delay: 0.5s;
      }
      .selo-card:nth-child(6) {
        animation-delay: 0.6s;
      }
    </style>
  </head>

  <body>
    <!-- Scripts globais -->
    <script src="../scripts/globals.js"></script>

    <div class="container">
      <!-- Cabeçalho -->
      <div class="header">
        <div class="header-top">
          <img
            class="header-image"
            src="../recursos/imagens/personagens/menina_normal.png"
            alt="Personagem SuperNetos"
          />
          <h1 class="header-title">SuperNetos</h1>
        </div>
        <p class="header-description">
          Conquiste figurinhas respondendo perguntas e se tornando um verdadeiro
          Super Neto!
        </p>
      </div>

      <!-- Estatísticas -->
      <div class="stats-container">
        <div class="stat-card">
          <span class="stat-number" id="total-selos">0</span>
          <span class="stat-label">Figurinhas Coladas</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="perguntas-respondidas">0</span>
          <span class="stat-label">Pontos Disponíveis</span>
        </div>
      </div>

      <!-- Álbum e Figurinhas Disponíveis -->
      <div class="album-container">
        <!-- Álbum -->
        <div class="album-section">
          <h2 class="section-title">📔 Meu Álbum</h2>
          <div class="album-grid" id="album-grid">
            <!-- Slots serão criados via JavaScript -->
          </div>
        </div>

        <!-- Figurinhas Disponíveis -->
        <div class="album-section" style="max-width: 400px">
          <h2 class="section-title">✨ Figurinhas Disponíveis</h2>
          <div class="available-stickers" id="available-stickers">
            <!-- Figurinhas disponíveis serão criadas via JavaScript -->
          </div>
        </div>
      </div>

      <!-- Grade de selos (antiga - manter por compatibilidade) -->
      <div class="figurinhas-grid" id="figurinhas-grid" style="display: none">
        <!-- Selos serão carregados aqui via JavaScript -->
      </div>

      <!-- Botões -->
      <div class="buttons-container">
        <a href="../../index.html" class="back-button">
          <span class="material-symbols-rounded">arrow_back</span>
          Voltar ao Início
        </a>

        <button class="reset-button" onclick="resetarProgresso()">
          <span class="material-symbols-rounded">restart_alt</span>
          Resetar Progresso
        </button>
      </div>
    </div>

    <script>
      // Definição das figurinhas disponíveis
      const figurinhasDisponiveis = [
        {
          id: 1,
          nome: "Primeiro Passo",
          descricao: "Completou suas primeiras 5 perguntas",
          icone: "🎯",
          imagem: "../recursos/imagens/figurinhas/01.jfif",
          perguntasNecessarias: 5,
        },
        {
          id: 2,
          nome: "Perseverança",
          descricao: "Respondeu 10 perguntas com dedicação",
          icone: "💪",
          imagem: "../recursos/imagens/figurinhas/02.jfif",
          perguntasNecessarias: 10,
        },
        {
          id: 3,
          nome: "Sabedoria",
          descricao: "Demonstrou conhecimento em 15 perguntas",
          icone: "🧠",
          imagem: "../recursos/imagens/figurinhas/03.jfif",
          perguntasNecessarias: 15,
        },
        {
          id: 4,
          nome: "Coração Generoso",
          descricao: "Mostrou empatia em 20 perguntas",
          icone: "❤️",
          imagem: "../recursos/imagens/figurinhas/04.jfif",
          perguntasNecessarias: 20,
        },
        {
          id: 5,
          nome: "SuperNeto",
          descricao: "Conquistou o título de SuperNeto com 25 perguntas",
          icone: "⭐",
          imagem: "../recursos/imagens/figurinhas/05.jfif",
          perguntasNecessarias: 25,
        },
      ];

      // Estado do álbum
      let pontosDisponiveis = 0;
      let albumColado = [];

      function carregarAlbum() {
        // Carregar pontos (perguntas respondidas)
        pontosDisponiveis = parseInt(
          localStorage.getItem("perguntasRespondidas") || "0"
        );

        // Carregar álbum colado
        albumColado = JSON.parse(localStorage.getItem("albumColado") || "[]");

        // Calcular quantas figurinhas foram coladas
        const totalColadas = albumColado.length;

        // Próxima figurinha disponível (sempre na ordem 1, 2, 3, 4, 5)
        const proximaFigurinhaId = totalColadas + 1;

        // Atualizar estatísticas
        document.getElementById("total-selos").textContent = totalColadas;
        document.getElementById("perguntas-respondidas").textContent =
          pontosDisponiveis;

        console.log("=== DEBUG ÁLBUM ===");
        console.log("Pontos disponíveis:", pontosDisponiveis);
        console.log("Total de figurinhas coladas:", totalColadas);
        console.log("Próxima figurinha disponível:", proximaFigurinhaId);
        console.log("Álbum colado:", albumColado);
        console.log("===================");

        // Criar slots do álbum
        const albumGrid = document.getElementById("album-grid");

        if (!albumGrid) {
          console.error("❌ Elemento album-grid não encontrado!");
          return;
        }

        console.log("✅ Elemento album-grid encontrado:", albumGrid);
        albumGrid.innerHTML = "";

        figurinhasDisponiveis.forEach((figurinha) => {
          const slot = document.createElement("div");
          slot.className = "album-slot";
          slot.dataset.id = figurinha.id;

          console.log(`Criando slot para figurinha ${figurinha.id}`);

          // Verificar se já foi colado
          const jaColado = albumColado.find((a) => a.id === figurinha.id);

          if (jaColado) {
            slot.classList.add("filled");
            slot.innerHTML = `
              <div class="sticker-in-album">
                <img src="${figurinha.imagem}" alt="${figurinha.nome}" />
                <div class="sticker-name">${figurinha.nome}</div>
              </div>
            `;
          } else {
            slot.innerHTML = `
              <div class="slot-number">${figurinha.id}</div>
              <div class="slot-label">${figurinha.nome}</div>
            `;

            // Adicionar eventos de drop apenas no slot vazio
            slot.addEventListener("dragover", handleDragOver);
            slot.addEventListener("drop", handleDrop);
            slot.addEventListener("dragleave", handleDragLeave);
          }

          // IMPORTANTE: Adicionar o slot ao grid!
          albumGrid.appendChild(slot);
          console.log(`Slot ${figurinha.id} adicionado ao DOM`);
        });

        console.log(
          `✅ Total de ${figurinhasDisponiveis.length} slots criados no álbum`
        );

        // Criar figurinhas disponíveis
        const availableStickers = document.getElementById("available-stickers");

        if (!availableStickers) {
          console.error("❌ Elemento available-stickers não encontrado!");
          return;
        }

        console.log(
          "✅ Elemento available-stickers encontrado:",
          availableStickers
        );
        availableStickers.innerHTML = "";

        figurinhasDisponiveis.forEach((figurinha) => {
          const jaColado = albumColado.find((a) => a.id === figurinha.id);

          // Só pode desbloquear se:
          // 1. Ainda não foi colada
          // 2. É a próxima na sequência (ID = total coladas + 1)
          // 3. Tem pelo menos 5 pontos disponíveis
          const ehProxima = figurinha.id === proximaFigurinhaId;
          const temPontos = pontosDisponiveis >= 5;
          const podeDesbloquear = !jaColado && ehProxima && temPontos;

          const stickerItem = document.createElement("div");
          stickerItem.className = "sticker-item";
          stickerItem.dataset.id = figurinha.id;

          if (jaColado) {
            stickerItem.classList.add("locked");
            stickerItem.draggable = false;
          } else if (podeDesbloquear) {
            stickerItem.draggable = true;
            stickerItem.addEventListener("dragstart", handleDragStart);
            stickerItem.addEventListener("dragend", handleDragEnd);
          } else {
            stickerItem.classList.add("locked");
            stickerItem.draggable = false;
          }

          let statusText;
          if (jaColado) {
            statusText = "✅ Já colada";
          } else if (!ehProxima) {
            statusText = `🔒 Cole a figurinha ${proximaFigurinhaId} primeiro`;
          } else if (!temPontos) {
            statusText = "🔒 Precisa de 5 pontos";
          } else {
            statusText = "✨ Arraste ou clique para colar";
          }

          stickerItem.innerHTML = `
            <img src="${figurinha.imagem}" alt="${figurinha.nome}" />
            <div class="sticker-info">
              <div class="name">${figurinha.nome}</div>
              <div class="cost">Custo: 5 pontos</div>
              <div class="status">${statusText}</div>
            </div>
          `;

          // Adicionar clique para dispositivos móveis
          if (podeDesbloquear) {
            stickerItem.addEventListener("click", () => {
              if (
                confirm(
                  `Deseja colar a figurinha "${figurinha.nome}" no álbum?\n\nCusto: 5 pontos`
                )
              ) {
                colarFigurinhaNoAlbum(figurinha.id);
              }
            });
          }

          availableStickers.appendChild(stickerItem);
        });
      }

      // Função para colar figurinha (usada por clique em mobile)
      function colarFigurinhaNoAlbum(figurinhaId) {
        const figurinha = figurinhasDisponiveis.find(
          (f) => f.id === figurinhaId
        );
        const proximaFigurinhaId = albumColado.length + 1;

        // Verificar se é a próxima na ordem
        if (figurinhaId !== proximaFigurinhaId) {
          alert(
            `⚠️ Você precisa colar as figurinhas em ordem!\nCole a figurinha ${proximaFigurinhaId} primeiro.`
          );
          return;
        }

        // Verificar se tem pontos suficientes (sempre 5 pontos)
        if (pontosDisponiveis < 5) {
          alert(
            `⚠️ Você precisa de 5 pontos para colar esta figurinha!\nVocê tem apenas ${pontosDisponiveis} pontos.`
          );
          return;
        }

        // Descontar 5 pontos
        pontosDisponiveis -= 5;
        localStorage.setItem(
          "perguntasRespondidas",
          pontosDisponiveis.toString()
        );

        // Adicionar ao álbum
        albumColado.push({
          id: figurinha.id,
          dataColagem: new Date().toISOString(),
        });
        localStorage.setItem("albumColado", JSON.stringify(albumColado));

        // Mostrar mensagem de sucesso
        mostrarMensagemSucesso(figurinha.nome);

        // Recarregar álbum
        carregarAlbum();
      }

      // Drag and Drop Handlers
      let draggedStickerId = null;

      function handleDragStart(e) {
        draggedStickerId = parseInt(e.currentTarget.dataset.id);
        e.currentTarget.classList.add("dragging");
        e.dataTransfer.effectAllowed = "move";
        e.dataTransfer.setData("text/plain", draggedStickerId);
        console.log("Iniciando arraste da figurinha:", draggedStickerId);
      }

      function handleDragEnd(e) {
        e.currentTarget.classList.remove("dragging");
        console.log("Finalizando arraste");
      }

      function handleDragOver(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        e.currentTarget.classList.add("drag-over");
        e.dataTransfer.dropEffect = "move";
        return false;
      }

      function handleDragLeave(e) {
        e.currentTarget.classList.remove("drag-over");
      }

      function handleDrop(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }
        if (e.preventDefault) {
          e.preventDefault();
        }

        e.currentTarget.classList.remove("drag-over");

        const slotId = parseInt(e.currentTarget.dataset.id);
        const proximaFigurinhaId = albumColado.length + 1;

        console.log("Drop no slot:", slotId);
        console.log("Figurinha arrastada:", draggedStickerId);
        console.log("Próxima esperada:", proximaFigurinhaId);

        // Verificar se está soltando na figurinha correta
        if (draggedStickerId !== slotId) {
          alert("⚠️ Coloque a figurinha no espaço correto!");
          return false;
        }

        // Verificar se é a próxima na ordem
        if (draggedStickerId !== proximaFigurinhaId) {
          alert(
            `⚠️ Você precisa colar as figurinhas em ordem!\nCole a figurinha ${proximaFigurinhaId} primeiro.`
          );
          return false;
        }

        const figurinha = figurinhasDisponiveis.find((f) => f.id === slotId);

        // Verificar se tem pontos suficientes (sempre 5 pontos)
        if (pontosDisponiveis < 5) {
          alert(
            `⚠️ Você precisa de 5 pontos para colar esta figurinha!\nVocê tem apenas ${pontosDisponiveis} pontos.`
          );
          return false;
        }

        // Descontar 5 pontos
        pontosDisponiveis -= 5;
        localStorage.setItem(
          "perguntasRespondidas",
          pontosDisponiveis.toString()
        );

        // Adicionar ao álbum
        albumColado.push({
          id: figurinha.id,
          dataColagem: new Date().toISOString(),
        });
        localStorage.setItem("albumColado", JSON.stringify(albumColado));

        // Animação de celebração
        e.currentTarget.classList.add("celebrate");
        setTimeout(() => {
          e.currentTarget.classList.remove("celebrate");
        }, 500);

        // Mostrar mensagem de sucesso
        mostrarMensagemSucesso(figurinha.nome);

        // Recarregar álbum
        setTimeout(() => {
          carregarAlbum();
        }, 600);

        return false;
      }

      function mostrarMensagemSucesso(nomeFigurinha) {
        const mensagem = document.createElement("div");
        mensagem.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 2rem 3rem;
          border-radius: 20px;
          font-size: 1.5rem;
          font-weight: bold;
          text-align: center;
          z-index: 10000;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
          animation: celebrate 0.5s ease;
        `;
        mensagem.innerHTML = `
          🎉 Parabéns! 🎉<br>
          Você colou a figurinha<br>
          "${nomeFigurinha}"!
        `;
        document.body.appendChild(mensagem);

        setTimeout(() => {
          mensagem.style.opacity = "0";
          mensagem.style.transition = "opacity 0.5s";
          setTimeout(() => mensagem.remove(), 500);
        }, 2000);
      }

      function carregarFigurinhas() {
        // Carregar figurinhas conquistadas do localStorage (usando chave correta)
        const figurinhasConquistadas = JSON.parse(
          localStorage.getItem("selosConquistados") || "[]"
        );

        // Obter contagem de perguntas únicas para lógica das figurinhas
        const gameProgress = JSON.parse(
          localStorage.getItem("gameProgress") || "[]"
        );
        let perguntasUnicas = gameProgress.length; // Para verificar bloqueio dos selos

        // Obter contagem TOTAL de perguntas respondidas para exibição
        const perguntasTotais = parseInt(
          localStorage.getItem("perguntasRespondidas") || "0"
        );

        // FALLBACK: Se gameProgress estiver vazio mas há perguntas respondidas,
        // usar perguntasRespondidas como base (compatibilidade com versões antigas)
        if (perguntasUnicas === 0 && perguntasTotais > 0) {
          perguntasUnicas = perguntasTotais;
          console.warn(
            "⚠️ gameProgress vazio, usando perguntasRespondidas como fallback"
          );
        }

        // Debug: mostrar valores no console
        console.log("=== DEBUG FIGURINHAS ===");
        console.log("gameProgress.length:", gameProgress.length);
        console.log("perguntasRespondidas:", perguntasTotais);
        console.log(
          "Perguntas únicas (usado para desbloqueio):",
          perguntasUnicas
        );
        console.log("Selos conquistados:", figurinhasConquistadas);
        console.log("========================");

        // Atualizar estatísticas (mostra TOTAL de perguntas respondidas)
        document.getElementById("total-selos").textContent =
          figurinhasConquistadas.length;
        document.getElementById("perguntas-respondidas").textContent =
          perguntasTotais;

        const figurinhasGrid = document.getElementById("figurinhas-grid");

        if (figurinhasDisponiveis.length === 0) {
          figurinhasGrid.style.display = "none";
          return;
        }

        figurinhasGrid.innerHTML = "";

        const primeiraLinha = document.createElement("div");
        primeiraLinha.className = "figurinhas-row";
        const segundaLinha = document.createElement("div");
        segundaLinha.className = "figurinhas-row";

        figurinhasDisponiveis.forEach((figurinhaDisponivel, index) => {
          const figurinhaConquistada = figurinhasConquistadas.find(
            (f) => f.id === figurinhaDisponivel.id
          );
          // A partir de 25 perguntas únicas, todos os selos ficam desbloqueados
          // Antes disso, verifica se foi conquistado OU se atingiu o número necessário
          const isLocked =
            perguntasUnicas < 25 &&
            !figurinhaConquistada &&
            perguntasUnicas < figurinhaDisponivel.perguntasNecessarias;

          // Debug para o selo 5 (SuperNeto)
          if (figurinhaDisponivel.id === 5) {
            console.log("=== DEBUG SELO 5 (SuperNeto) ===");
            console.log("perguntasUnicas:", perguntasUnicas);
            console.log("perguntasUnicas < 25:", perguntasUnicas < 25);
            console.log("figurinhaConquistada:", figurinhaConquistada);
            console.log("!figurinhaConquistada:", !figurinhaConquistada);
            console.log(
              "perguntasNecessarias:",
              figurinhaDisponivel.perguntasNecessarias
            );
            console.log(
              "perguntasUnicas < perguntasNecessarias:",
              perguntasUnicas < figurinhaDisponivel.perguntasNecessarias
            );
            console.log("isLocked:", isLocked);
            console.log("================================");
          }

          const figurinhaCard = document.createElement("div");
          const orientationClass = index < 2 ? "horizontal" : "vertical";
          figurinhaCard.className = `selo-card ${orientationClass} ${
            isLocked ? "locked" : ""
          }`;

          figurinhaCard.dataset.id = figurinhaDisponivel.id;
          figurinhaCard.dataset.nome = figurinhaDisponivel.nome;

          let dataText = "";
          if (figurinhaConquistada) {
            const data = new Date(figurinhaConquistada.dataConquista);
            dataText = `<div class="selo-date">Conquistada em ${data.toLocaleDateString(
              "pt-BR"
            )}</div>`;
          }

          // Sempre mostrar a imagem da figurinha
          figurinhaCard.innerHTML = `
            <img src="${figurinhaDisponivel.imagem}" alt="${figurinhaDisponivel.nome}" class="selo-image" />
            <div class="selo-name">${figurinhaDisponivel.nome}</div>
            <div class="selo-description">${figurinhaDisponivel.descricao}</div>
            ${dataText}
          `;

          if (index < 2) {
            primeiraLinha.appendChild(figurinhaCard);
          } else {
            segundaLinha.appendChild(figurinhaCard);
          }
        });

        if (primeiraLinha.children.length > 0) {
          figurinhasGrid.appendChild(primeiraLinha);
        }

        if (segundaLinha.children.length > 0) {
          figurinhasGrid.appendChild(segundaLinha);
        }

        // Se não há selos e não há perguntas únicas, mostrar estado vazio
        if (figurinhasConquistadas.length === 0 && perguntasUnicas === 0) {
          emptyState.style.display = "block";
        }
      }

      // Função para resetar todo o progresso
      function resetarProgresso() {
        const confirmacao = confirm(
          "⚠️ Tem certeza que deseja resetar todo o progresso?\n\n" +
            "Isso irá apagar:\n" +
            "• Todas as figurinhas coladas no álbum\n" +
            "• Todos os selos conquistados\n" +
            "• Progresso das perguntas\n" +
            "• Contagem de perguntas respondidas\n" +
            "• Resultados salvos\n\n" +
            "Esta ação não pode ser desfeita!"
        );

        if (confirmacao) {
          // Remover todos os dados do localStorage relacionados ao jogo
          localStorage.removeItem("albumColado");
          localStorage.removeItem("selosConquistados");
          localStorage.removeItem("perguntasRespondidas");
          localStorage.removeItem("gameProgress");
          localStorage.removeItem("totalAttempts");
          localStorage.removeItem("gameResults");

          // Recarregar a página para atualizar a interface
          location.reload();

          alert("✅ Progresso resetado com sucesso!");
        }
      }

      // Carregar álbum quando a página carrega
      document.addEventListener("DOMContentLoaded", function () {
        carregarAlbum();
        carregarFigurinhas(); // Manter compatibilidade com visualização antiga
      });
    </script>
  </body>
</html>
